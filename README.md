ai-tracker ‚Äî Telegram productivity bot (MVP)

## Overview

ai-tracker ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram‚Äë–±–æ—Ç –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∑–∞–¥–∞—á –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –¥–Ω—è–º –≤ —Å—Ç–∏–ª–µ nb_bot:

- —á—ë—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `bot/`, `core/`, `db/`, `services/`, `workers/`
- –∑–∞–¥–∞—á–∏ —Å –ø–ª–∞–Ω–æ–≤—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ —Ä–µ–∞–ª—å–Ω—ã–º —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
- —Ç–∞–π–º–µ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö —á–µ—Ä–µ–∑ Redis
- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—é –∏ –Ω–µ–¥–µ–ª–µ
- –±–µ–∫–ª–æ–≥ –∑–∞–¥–∞—á –Ω–∞ –±—É–¥—É—â–µ–µ
- –ª—ë–≥–∫–∏–µ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—Å–µ—Ö –∑–∞–¥–∞—á

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

- Python 3.11, Poetry
- aiogram 3 (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram‚Äë—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
- Tortoise ORM + PostgreSQL
- Redis (—Ç–∞–π–º–µ—Ä—ã –∏ FSM‚Äë—Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
- Docker / docker-compose, GitHub Actions

## Project structure

```text
app/
  bot/
    handlers/      # —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã, –±–µ–∑ –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∏
    keyboards/     # –≤—Å–µ –∏–Ω–ª–∞–π–Ω‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    middlewares/   # —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, DI –Ω–∞—Å—Ç—Ä–æ–µ–∫
    states/        # FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏—è
    callbacks/     # callback‚Äëdata —Ñ–∞–±—Ä–∏–∫–∏
    bot.py         # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bot –∏ Dispatcher
  core/
    config.py      # Settings (env ‚Üí dataclasses)
    logger.py      # –µ–¥–∏–Ω—ã–π –ª–æ–≥–≥–µ—Ä
    redis.py       # —Ñ–∞–±—Ä–∏–∫–∞ Redis‚Äë–∫–ª–∏–µ–Ω—Ç–∞
    constants.py   # –ø—Ä–µ—Ñ–∏–∫—Å—ã, –∏–º–µ–Ω–∞ –∏ —Ç.–ø.
  db/
    models/        # User, Task, ActiveTimer
    config.py      # Tortoise ORM config
    init.py        # init_db / close_db
  services/
    user_service.py
    tasks_service.py
    timers_service.py
    stats_service.py
    ai_service.py
    motivation_service.py
    backlog_service.py
  workers/
    timers_worker.py  # –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á
    cron_worker.py    # –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ/—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –∏ cleanup
  main.py          # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
```

–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è: –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ `services/`, —Ö–µ–Ω–¥–ª–µ—Ä—ã ‚Äî —Ç–æ–ª—å–∫–æ ¬´—Å–∫–ª–µ–π–∫–∞¬ª –º–µ–∂–¥—É Telegram –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

## Local development

### 1. Requirements

- Python 3.11
- Poetry
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Redis/Postgres)

### 2. Install

```bash
poetry install
```

### 3. Environment

–°–æ–∑–¥–∞–π `.env` –≤ –∫–æ—Ä–Ω–µ (—Ä—è–¥–æ–º —Å `docker-compose.yml`), –Ω–∞–ø—Ä–∏–º–µ—Ä:

```env
BOT_TOKEN=your_telegram_bot_token

DB_URL=postgres://ai_tracker:ai_tracker@db:5432/ai_tracker
REDIS_URL=redis://redis:6379/0

DEFAULT_TIMEZONE=UTC

YANDEX_GPT_API_KEY=your_yandex_gpt_api_key
YANDEX_GPT_FOLDER_ID=your_yandex_folder_id
YANDEX_GPT_ENDPOINT=https://llm.api.cloud.yandex.net/foundationModels/v1/completion

DAILY_SUMMARY_HOUR=23
DAILY_SUMMARY_MINUTE=59
WEEKLY_REPORT_WEEKDAY=6
WEEKLY_REPORT_HOUR=23
REMINDERS_INTERVAL_HOURS=2
MORNING_PLAN_HOUR=8
MORNING_PLAN_MINUTE=0
```

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `docker-compose.yml` (–ø–æ–¥–Ω–∏–º–µ—Ç Postgres –∏ Redis).

### 4. Run locally

–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ Poetry):

```bash
poetry run python -m app.main
```

–û—Ç–¥–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä—ã:

```bash
poetry run python -m app.workers.timers_worker
poetry run python -m app.workers.cron_worker
```

## Docker

### Build image

```bash
docker build -t your_dockerhub_username/ai-tracker:latest .
```

### Dev docker-compose

–õ–æ–∫–∞–ª—å–Ω–æ (–±–æ—Ç + –≤–æ—Ä–∫–µ—Ä—ã + –ë–î + Redis):

```bash
docker-compose up --build
```

## Production

### docker-compose.prod.yml

–í –ø—Ä–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π –æ–±—Ä–∞–∑ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π `docker-compose.prod.yml`:

- `bot` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ (long polling)
- `timers_worker` ‚Äî —Ñ–æ–Ω–æ–≤—ã–π —Ç–∏–∫–µ—Ä —Ç–∞–π–º–µ—Ä–æ–≤
- `cron_worker` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ/—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ cleanup
- `db` ‚Äî PostgreSQL
- `redis` ‚Äî Redis

–í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ env‚Äë–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–æ–±—ã—á–Ω–æ –∏–∑ GitHub Actions secrets).

### GitHub Actions (Build & Deploy)

–í `.github/workflows/build-deploy.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–∞–π–ø–ª–∞–π–Ω:

1. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –æ–±—Ä–∞–∑ –≤ Docker Hub:
   - –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ `DOCKERHUB_USERNAME` / `DOCKERHUB_TOKEN`
   - —Ç–µ–≥: `${DOCKERHUB_USERNAME}/ai-tracker:latest`
2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   - ssh –∫ —Å–µ—Ä–≤–µ—Ä—É (—Å–µ–∫—Ä–µ—Ç—ã `SSH_HOST`, `SSH_USER`, `SSH_PRIVATE_KEY`, `SSH_PORT`)
   - –ø–µ—Ä–µ–π—Ç–∏ –≤ `ai-tracker/`
   - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å env (Postgres, —Ç–æ–∫–µ–Ω—ã –±–æ—Ç–∞, GPT –∏ cron‚Äë–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
   - `docker-compose -f docker-compose.prod.yml pull`
   - `docker-compose -f docker-compose.prod.yml up -d --no-deps bot timers_worker cron_worker`

## Bot UX (–∫–æ—Ä–æ—Ç–∫–æ)

- /start:
  - ¬´üìÖ –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è¬ª + —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
  - –∏–Ω–ª–∞–π–Ω‚Äë–∫–Ω–æ–ø–∫–∏:
    - `‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É`
    - `üìÖ –ë–µ–∫–ª–æ–≥`
    - `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞`
- –ó–∞–¥–∞—á–∏:
  - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (title + minutes)
  - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –±—É–¥—É—â–µ–µ (title + minutes + date, –Ω–µ —Ä–∞–Ω—å—à–µ —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–µ –¥–∞–ª—å—à–µ 30 –¥–Ω–µ–π)
  - FSM –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–Ω—É—Ç `1..999`
- –¢–∞–π–º–µ—Ä—ã:
  - `‚ñ∂Ô∏è` ‚Äî —Å—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä–∞ (–≤–æ—Ä–∫–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
  - `‚è∏` / `‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å`
  - `‚úîÔ∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å` ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è
  - `‚ûï +5 –º–∏–Ω` –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ (—á–µ—Ä–µ–∑ FSM)
- –ê–≤—Ç–æ‚Äë–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:
  - –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ `planned_seconds` –≤–æ—Ä–∫–µ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –ó–∞–≤–µ—Ä—à–µ–Ω—ã –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞ –¥–µ–Ω—å:
  - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–æ–µ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—É–ª–∞ (–±–µ–∑ –≤—ã–∑–æ–≤–∞ AI)

## Code style / best practices

- **Handlers**:
  - –º–∏–Ω–∏–º—É–º –ª–æ–≥–∏–∫–∏, —Ç–æ–ª—å–∫–æ –≤—ã–∑–æ–≤—ã —Å–µ—Ä–≤–∏—Å–æ–≤ + —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/–∫–ª–∞–≤–∏–∞—Ç—É—Ä
  - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (start/add/pause/complete/extend)
- **Services**:
  - —á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞
  - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Bot`/`Message`/`CallbackQuery` –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- **DB / ORM**:
  - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Tortoise ORM
  - –Ω–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ –≤ –º–æ–¥–µ–ª—è—Ö, –∫—Ä–æ–º–µ –ø—Ä–æ—Å—Ç—ã—Ö enum‚Äë–ø–æ–¥–æ–±–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- **FSM**:
  - –æ—Ç–¥–µ–ª—å–Ω—ã–µ `StatesGroup` –Ω–∞ –∫–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (`AddTask`, `AddFutureTask`, `ExtendTask`)
  - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ, –∫–æ—Ä–æ—Ç–∫–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –æ—à–∏–±–æ–∫
- **Timers**:
  - –Ω–∏–∫–∞–∫–∏—Ö `sleep` –≤ —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö, —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ —Ç–∞–π–º–µ—Ä–∞ –≤ Redis
  - –≤—Å—ë —Ç–∏–∫–∞–Ω—å–µ –∏ –∞–≤—Ç–æ‚Äë–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ `timers_worker`
- **Config**:
  - –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ env ‚Üí `core.config.Settings`
  - –Ω–∏–∫–∞–∫–æ–≥–æ —Ö–∞—Ä–¥–∫–æ–¥–∞ URL/—Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–æ–¥–µ
- **Deploy**:
  - –æ–¥–∏–Ω –æ–±—Ä–∞–∑ –Ω–∞ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (bot + workers)
  - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `docker-compose.prod.yml` –∏ GitHub Actions

–ë–æ—Ç —É–∂–µ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å MVP: –æ–Ω —É–º–µ–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–∫–∞—Ç—å –≤—Ä–µ–º—è, —Å–ª–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –ø–æ–¥–±–∞–¥—Ä–∏–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è. –î–∞–ª–µ–µ –º–æ–∂–Ω–æ –Ω–∞—Ä–∞—â–∏–≤–∞—Ç—å —Ñ–∏—á–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ñ–∏–ª—å—Ç—Ä—ã, –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞) –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
